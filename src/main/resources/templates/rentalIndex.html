<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- Meta, title, CSS, favicons, etc. -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Gentelella Alela! |</title>

<!-- Bootstrap -->
<link href="../vendors/bootstrap/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Font Awesome -->
<link href="../vendors/font-awesome/css/font-awesome.min.css"
	rel="stylesheet">
<!-- NProgress -->
<link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
<!-- iCheck -->
<link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">

<!-- bootstrap-datetimepicker -->
<link
	href="../vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css"
	rel="stylesheet">

<!-- Custom Theme Style -->
<link href="../build/css/custom.min.css" rel="stylesheet">
</head>
<body class="nav-md">
	<div class="container body">
		<div class="main_container">
			<!-- sidebar -->
			<div th:insert="/fragments/sidebar :: sidebar" th:remove="tag"></div>
			<!-- sidebar -->

			<!-- top navigation -->
			<div th:insert="/fragments/top_nav :: top_nav" th:remove="tag"></div>
			<!-- /top navigation -->

			<!-- page content -->
			<div class="right_col" role="main">
				<div class="">
					<div class="page-title">
						<div class="title_left">
							<h3>貸与一覧</h3>
						</div>
					</div>

					<div class="clearfix"></div>

					<div class="row">
						<div class="col">
							<div class="col-md-1">
								<span class="pull-right" style="font-size: 18px;">管理番号</span>
							</div>
							<div class="col-md-2">
								<input type="text" class="form-control" placeholder="管理番号"
									id="assetNumber_search">
							</div>




							<div class="col-md-1">
								<span class="pull-right" style="font-size: 18px;">貸与日</span>
							</div>
							<div class="col-md-2">
								<div class="input-group date" id="myDatepicker">
									<input type="text" class="form-control" id="date_search">
									<span class="input-group-addon"> <span
										class="glyphicon glyphicon-calendar"></span>
									</span>
								</div>
							</div>
							<div class="buttons">

									<button type="button" onclick="modalInsert()">貸与</button>



							</div>
							<div class="x_panel">
								<div class="x_title">

									<div class="clearfix"></div>
								</div>
								<div class="x_content">
									<table class="table table-striped jambo_table bulk_action"
										id="table1">


										<thead class="thead-light">


											<tr class="headings">



												<th class="col-md-2">貸与番号</th>
												<th class="col-md-2">管理番号</th>
												<th class="col-md-1">品目</th>
												<th class="col-md-1">場所</th>
												<th class="col-md-1">使用者</th>
												<th class="col-md-1">貸与日</th>
												<th class="col-md-1">貸与期間</th>
												<th class="col-md-2">Action</th>

											</tr>

										</thead>
										<tbody>
										</tbody>
									</table>

									<!--update modal -->
									<div class="modal" id="modal3d" tabindex="-1" role="dialog"
										style="display: none;" aria-hidden="true">
										<div class="modal-dialog modal-xl" style="width: 70%;"
											role="document">
											<div class="modal-content">
												<div class="modal-header">
													<button type="button" class="close" data-dismiss="modal"
														aria-label="Close">
														<span aria-hidden="true">×</span>
													</button>
													<h3 class="modal-title">照会</h3>
												</div>

												<div class="modal-body">
													<div class="container-fluid">
														<div class="row">

															<div class="col-md-6">
																<div class="row">
																	<div class="col-md-3">
																		<span>貸与番号</span>
																	</div>
																	<div class="col-md-3">
																		<span id="rentNumber_view"></span>
																	</div>
																</div>
																<div class="row">
																	<div class="col-md-3">
																		<span>管理番号</span>
																	</div>
																	<div class="col-md-3">
																		<span id="assetNumber_view"></span>
																	</div>
																</div>
																<div class="row">
																	<div class="col-md-3">
																		<span>区分</span>
																	</div>
																	<div class="col-md-3">
																		<span id="psNum_view"></span>
																	</div>
																</div>



																<div class="row">
																	<div class="col-md-3">
																		<span>用途</span>
																	</div>
																	<div class="col-md-3">
																		<span id="purpose_view"></span>
																	</div>
																</div>
																<div class="row">
																	<div class="col-md-3">
																		<span>保管位置</span>
																	</div>
																	<div class="col-md-3">
																		<span id="storageLocation_view"></span>
																	</div>
																</div>
																<div class="row">
																	<div class="col-md-3">
																		<span>貸与日</span>
																	</div>
																	<div class="col-md-4">
																		<span id="rentalDay_view"></span>
																	</div>
																</div>
																<div class="row">
																	<div class="col-md-3">
																		<span>特記事項</span>
																	</div>
																	<div class="col-md-3">
																		<span id="speciality_view"></span>
																	</div>
																</div>

																<div class="row">
																	<div class="col-md-3">
																		<span>貸与期間</span>
																	</div>
																	<div class="col-md-4">
																		<span id="returnPeriod_view"></span>
																	</div>

																</div>

															</div>

														</div>
													</div>
												</div>


												<hr>

												<div></div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary"
														data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<!-- /update modal -->

									<!--insert modal -->
									<div class="modal" id="modal3d2" tabindex="-1" role="dialog"
										style="display: none;" aria-hidden="true">
										<div class="modal-dialog modal-xl" style="width: 70%;"
											role="document">
											<div class="modal-content">
												<div class="modal-header">
													<button type="button" class="close" data-dismiss="modal"
														aria-label="Close">
														<span aria-hidden="true">×</span>
													</button>
													<h3 class="modal-title">貸与</h3>
												</div>

												<div class="modal-body">
														<div class="x_content">
									<br>
									<div class="form-group row ">
										<label class="control-label col-md-3 col-sm-3 ">日付</label>
										<div class="col-md-9 col-sm-9 ">
											<input type="text" class="form-control col-md-10"
												id="todayDate" th:value="${#dates.createNow()}"
												readonly="readonly">
										</div>
									</div>

									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">使用者</label>
										<div class="col-md-9 col-sm-9 ">
											<input type="text" name="rentUser"
												class="form-control col-md-10" />
										</div>
									</div>
									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">用途</label>
										<div class="col-md-9 col-sm-9 ">
											<input type="text" class="form-control col-md-10"
												id="purpose" value="勤務">
										</div>
									</div>
									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">場所</label>
										<div class="col-md-9 col-sm-9 ">
											<input type="text" id="storageLocation" value="自社"
												class="form-control col-md-10">
										</div>
									</div>
									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">特記事項</label>

										<div class="col-md-9 col-sm-9 ">
											<input type="text" id="speciality"
												class="form-control col-md-10">
										</div>
									</div>
									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">分類</label>
										<div class="col-md-9 col-sm-9 ">
											<select class="form-control" id="singleSelect"
												name="selectedItem" onchange="getSubItem()">
												<option value="">選択</option>
												<option th:each="productKindCode : ${statusCodeMap}"
													th:value="${productKindCode.codedetailid}"
													th:text="${productKindCode.codedetailname}"></option>
											</select>

										</div>
									</div>
									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">種類</label>

										<div class="col-md-9 col-sm-9 ">

											<select class="select2_multiple form-control"
												id="sub_singleSelect" name="sub_selectedItem"
												onchange="getSubSubItem()">

												<option value="">選択</option>
											</select>

										</div>

									</div>


									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">選択</label>
										<div class="col-md-9 col-sm-9 ">
											<select class="select2_multiple form-control"
												id="sub_subSelect" name="selectedSubItem"
												onchange="writeItem()">
												<option value="">選択</option>

											</select>
										</div>
									</div>





									<div class="form-group row">
										<label class="control-label col-md-3 col-sm-3 ">貸与目録</label><br>
									</div>
									<div class="form-group row">
										<table id="selectedAsset">
											<tr>
												<th class="col-md-2">貸与番号</th>
												<th class="col-md-1">貸与者</th>
												<th class="col-md-1">分類</th>
												<th class="col-md-1">種類</th>
												<th class="col-md-1">管理番号</th>
												<th class="col-md-1">用途</th>
												<th class="col-md-1">場所</th>
												<th class="col-md-1">特記事項</th>
											</tr>

											<tbody></tbody>
										</table>

									</div>


								</div>
												</div>


												<hr>

												<div></div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary"
														data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<!-- /insert modal -->

								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /page content -->

			<!-- footer content -->
			<div th:insert="/fragments/footer :: footer" th:remove="tag"></div>
			<!-- /footer content -->
		</div>
	</div>

	<!-- jQuery -->
	<script src="../vendors/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap -->
	<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- jquery-ui -->
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<!-- DataTable -->
	<script th:src="@{/DataTables-1.10.20/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/DataTables-1.10.20/js/dataTables.bootstrap4.min.js}"></script>

	<!-- FastClick -->
	<script src="../vendors/fastclick/lib/fastclick.js"></script>
	<!-- NProgress -->
	<script src="../vendors/nprogress/nprogress.js"></script>
	<!-- iCheck -->
	<script src="../vendors/iCheck/icheck.min.js"></script>
	<!-- bootstrap-datetimepicker -->
	<script src="../vendors/moment/min/moment.min.js"></script>
	<script
		src="../vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
	<!-- Custom Theme Scripts -->
	<script src="../build/js/custom.min.js"></script>

	<!-- page script -->
	<script th:inline="javascript">
    /*<![CDATA[*/
        $('#myDatepicker').datetimepicker({
            format: 'YYYY/MM/DD'
        });

        var modalesectiondata = null;

    	var kubunCodeMap = new Map();
    	var kubunItemMap = new Map();
		var kubunCode = /*[[${kubunCode}]]*/;
		kubunCode.forEach(function( value ) {
			kubunCodeMap.set(value.codeDetailId,value.item1);

    	});
		kubunCode.forEach(function( value ) {
		kubunItemMap.set(value.codeDetailId, value.item2);	});
    	var statusCodeMap = new Map();
    	var statusCode = /*[[${statusCode}]]*/;
    	statusCode.forEach(function( value ) {
    		statusCodeMap.set(value.codeDetailId, value.codeDetailName);
    	});

        $(function(){

            // datatableの設定を変更
            var modalesectiontable = $("#table1").DataTable({
            	"language": {
            		"info":           "表示 _START_ ~ _END_ の _TOTAL_ エントリ",
            		"infoEmpty":      "表示 0 ~ 0 の 0 エントリ",
            	    "infoFiltered":   "",
            	    "paginate": {
            	        "first":      "最初",
            	        "last":       "最後",
            	        "next":       "次へ",
            	        "previous":   "前の"
            	    }
                },
            	fixedHeader: true,
            	"processing": true,
            	"serverSide": true,
            	"start": 0,
                "length": 10,
                "searching": false,
                "paging": true,
                "lengthChange": false,
                "ordering": false,

                "ajax": {
                	url: /*[[@{/rental/getRentalList}]]*/ 'rental/getRentalList',
                	type: "POST",
                	dataType: "json",
                	contentType: 'application/JSON',
                	data: function ( d ) {
                		d.columns[0].search.value = $('#assetNumber_search').val();
                		d.columns[1].search.value = $('#date_search').val();
                        return JSON.stringify(d);
                    }
                },

                "columnDefs": [


                	{ targets: 0, data: "rentalNo"},

                    { targets: 1, data: "assetNumber"},

                    { targets: 2, data: function ( d ) {
                    	return kubunItemMap.get(d.kubunCode);
                    }},

                    { targets: 3, data: "storageLocation"},

                    { targets: 4, data: "rentalUserId"},

                    { targets: 5, data: "rentalDay"},

                    { targets: 6, data: "returnPeriod"},

                    { targets: 7,
                    	data: "description",
                        render: function ( data, type, row, meta ) {
                          return '<button type="button" class="btn btn-warning" onclick = "location.href =\'' +
                          'rental/' + row.assetNumber + '\'">更新</button><button type="button" class="btn btn-danger" onclick = "location.href =\'' +
                          'rental/' + row.assetNumber + '\'">削除</button>';
                        }
                    }
                ]
            });

            // Search
            $('#assetNumber_search').on( 'keyup', function () {
            	modalesectiontable
                .column(0)
                .search( this.value )
                .draw();
            } );







            $("#myDatepicker").on("dp.change", function(e) {
                var d = new Date(e.date);
                var mm = d.getMonth() + 1;
                var dd = d.getDate();
                var yyyy = d.getFullYear();
            	modalesectiontable.column(5).search( yyyy + "-" + mm + "-" + dd ).draw();
            });

          /*   $('#table1 tbody').on( 'click', 'tr td', function () {
            	var rowData = modalesectiontable.row( this ).data();
            	if(this._DT_CellIndex.column !=8 &&this._DT_CellIndex.column !=0) {
            		$('#modal3d').modal();

            		var rentDay = new Date(rowData.rentDay);
            		var yyyy = rentDay.getFullYear(); var mm = rentDay.getMonth()+1;
            		var dd = rentDay.getDate();

            		var returnPeriod = new Date(rowData.returnPeriod);
            		var y = returnPeriod.getFullYear();  var m= returnPeriod.getMonth()+1;
            		var d = returnPeriod.getDate();
					$('#rentNumber_view').text(rowData.rentNumber);
            		$('#assetNumber_view').text(rowData.assetNumber);
            		$('#psNum_view').text(productCodeMap.get(rowData.psNum));
            		$('#purpose_view').text((rowData.purpose));
            		$('#rentDay_view').text(yyyy + "-" + mm + "-" + dd);
            		$('#speciality_view').text(rowData.speciality);
            		$('#purpose_view').text(rowData.purpose);
            		$('#storageLocation_view').text(rowData.storageLocation);
            		$('#sNumber_view').text(stateCodeMap.get(rowData.snumber));

            		$('#returnPeriod_view').text(y + "-" + m+ "-" + d);

            	} else {
            		//alert(JSON.stringify(rowData));
            	}
            } ); */

        })
    /*]]>*/
    </script>
	<script th:inline="javascript">
	function modalInsert() {



    		$('#modal3d2').modal();



    	}
		function getSubItem() {

			$('#singleSelect').click(
					function() {
						$.getJSON("/rental/selectFirst", {
							pcNum : $(this).val(),
							ajax : 'true'
						}, function(data) {
							var html = '<option value="">選択</option>';
							data.forEach(function(value) {

								html += '<option value="' +value.psNum + '">'
										+ value.pname + '</option>';
							})
							$('#sub_singleSelect').html(html);
						});
					});

		}
	</script>
	<script th:inline="javascript">
		function getSubSubItem() {

			$('#sub_singleSelect').click(
					function() {
						$.getJSON("/rental/selectSecond", {
							psNum : $(this).val(),
							ajax : 'true'
						}, function(data) {
							var html = '<option value="">選択</option>';

							data.forEach(function(value) {
								html += '<option value="' + value.psNum + '">'
										+ value.assetNumber + '</option>';
							})
							$('#sub_subSelect').html(html);

						});
					});

		}
	</script>
	<script th:inline="javascript">

		function writeItem() {

			var assetNumber = $('#sub_subSelect').text();
			alert(assetNumber);
			var todayDate = $('#todayDate').val();
			alert(todayDate);
			var rentUser = $('#rentUser').val();
			var pcCode = $('#singleSelect').val();
			var psNum = $('#sub_singleSelect').val();

			$('#sub_subSelect').click(
							function() {


	$('#selectedAsset tbody').append('<tr><td>'+assetNumber+'</td><td>'+pcCode+'</td><td>'+assetNumber+'</td><td>'+assetNumber+'</td><td>'+assetNumber+'</td><td>'+assetNumber+'</td><td>'+assetNumber+'</td><td>'+assetNumber+'</td></tr>');
												});
		}

	</script>

</body>
</html>