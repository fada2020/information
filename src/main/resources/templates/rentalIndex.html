<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- Meta, title, CSS, favicons, etc. -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>IT資産管理</title>

<!-- favicons -->
<link rel="icon" href="../images/aisRogo.png">
<!-- Bootstrap -->
<link href="../vendors/bootstrap/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Font Awesome -->
<link href="../vendors/font-awesome/css/font-awesome.min.css"
	rel="stylesheet">
<!-- NProgress -->
<link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
<!-- iCheck -->
<link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">

<!-- bootstrap-daterangepicker -->
<link href="../vendors/bootstrap-daterangepicker/daterangepicker.css"
	rel="stylesheet">
<!-- bootstrap-datetimepicker -->
<link
	href="../vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css"
	rel="stylesheet">


<!-- Custom Theme Style -->
<link href="../build/css/custom.min.css" rel="stylesheet">
</head>
<body class="nav-md">
	<div class="container body">
		<div class="main_container">
			<!-- sidebar -->
			<div th:insert="/fragments/sidebar :: sidebar" th:remove="tag"></div>
			<!-- sidebar -->

			<!-- top navigation -->
			<div th:insert="/fragments/top_nav :: top_nav" th:remove="tag"></div>
			<!-- /top navigation -->

			<!-- page content -->
			<div class="right_col" role="main">
				<div class="">
					<div class="page-title">
						<div class="title_left">
							<h3>貸与一覧</h3>
						</div>
					</div>

					<div class="clearfix"></div>

					<div class="row">
						<div class="col">
							<div class="col-md-1">
								<span class="pull-right" style="font-size: 18px;">管理番号</span>
							</div>
							<div class="col-md-2">
								<input type="text" class="form-control" placeholder="管理番号"
									id="assetNumber_search">
							</div>

							<div class="col-md-1">
								<span class="pull-right" style="margin-left: -10%;">貸与日</span>
							</div>
							<div class="col-md-2">
								<fieldset>
									<div class="control-group ">
										<div class="controls">
											<div class="input-prepend input-group">
												<span class="add-on input-group-addon"><i
													class="glyphicon glyphicon-calendar fa fa-calendar"></i></span> <input
													type="text" style="width: 200px" name="rental_search"
													id="rental_search" class="form-control">
											</div>
										</div>
									</div>
								</fieldset>
							</div>




							<div class="x_panel">
								<div class="x_title">

									<div class="clearfix"></div>
								</div>
								<div class="x_content">
									<table class="table table-striped jambo_table bulk_action"
										id="table1">


										<thead class="thead-light">


											<tr class="headings">



												<th class="col-md-2">貸与番号</th>
												<th class="col-md-2">管理番号</th>
												<th class="col-md-1">品目</th>
												<th class="col-md-1">場所</th>
												<th class="col-md-1">使用者</th>
												<th class="col-md-1">貸与日</th>
												<th class="col-md-1">貸与期間</th>
												<th class="col-md-2">Action</th>

											</tr>

										</thead>
										<tbody>
										</tbody>
									</table>
									<div class="col-md-1">
										<button type="button" id="deleteButton" class="btn btn-danger"
											onclick="modalInsert()">貸与</button>

									</div>

									<!--update modal -->
									<div class="modal" id="modal3d" tabindex="-1" role="dialog"
										style="display: none;" aria-hidden="true">
										<div class="modal-dialog modal-xl" style="width: 70%;"
											role="document">
											<div class="modal-content">
												<div class="modal-header">
													<button type="button" class="close" data-dismiss="modal"
														aria-label="Close">
														<span aria-hidden="true">×</span>
													</button>
													<h3 class="modal-title">照会</h3>
												</div>

												<div class="modal-body">
													<div class="container-fluid">
														<div class="row">

															<div class="col-md-12" id="moddal_update">
																<div class="col-md-3">
																	<span>貸与番号</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="rentalNo_view"
																		readonly="readonly" class="form-control" />
																</div>
																<div class="col-md-3">
																	<span>管理番号</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="assetNumber_view"
																		readonly="readonly" class="form-control" />
																</div>
																<div class="col-md-3">
																	<span>品目</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="codeDetailName_view"
																		readonly="readonly" class="form-control" />
																</div>
																<div class="col-md-3">
																	<span>用途</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="purpose_view"
																		class="form-control" />
																</div>
																<div class="col-md-3">
																	<span>場所</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="storageLocation_view"
																		class="form-control" />
																</div>
																<div class="col-md-3">
																	<span>貸与日</span>
																</div>
																<div class="col-md-9">
																	<div class="input-group date" id="rentalDay_search">
																		<input type="text" class="form-control"
																			name="rentalDay" id="rentalDay_view"> <span
																			class="input-group-addon"> <span
																			class="glyphicon glyphicon-calendar"></span>
																		</span>
																	</div>
																</div>

																<div class="col-md-3">
																	<span>特記事項</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="speciality_view"
																		class="form-control" />
																</div>
																<div class="col-md-3">
																	<span>貸与期間</span>
																</div>
																<div class="col-md-9">
																	<div class="input-group date" id="returnPeriod_search"
																		name="myDatepicker">
																		<input type="text" class="form-control"
																			name="returnPeriod" id="returnPeriod_view"> <span
																			class="input-group-addon"> <span
																			class="glyphicon glyphicon-calendar"></span>
																		</span>
																	</div>
																</div>

																<div class="col-md-3">
																	<span>使用者</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="rentalUserId_view"
																		class="form-control" />
																</div>
																<div class="col-md-3">
																	<span>貸与者</span>
																</div>
																<div class="col-md-9">
																	<input type="text" id="applicantId_view"
																		class="form-control" />
																</div>

																<input type="hidden" id="assetSeq_hidden"
																	class="form-control" />


															</div>

														</div>
													</div>
												</div>


												<hr>

												<div>
													<button type="button" class="btn btn-warning"
														id="updateButton" onclick="updateRental()">更新</button>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary"
														data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<!-- /update modal -->

									<!--insert modal -->
									<div class="modal" id="modal3d2" tabindex="-1" role="dialog"
										style="display: none;" aria-hidden="true">
										<div class="modal-dialog modal-xl" style="width: 70%;"
											role="document">
											<div class="modal-content">
												<div class="modal-header">
													<button type="button" class="close" data-dismiss="modal"
														aria-label="Close">
														<span aria-hidden="true">×</span>
													</button>
													<h3 class="modal-title">貸与</h3>
												</div>

												<div class="modal-body">
													<div class="x_content">
														<br>
														<div class="form-group row ">
															<label class="control-label col-md-3 col-sm-3 ">日付</label>
															<div class="col-md-9 col-sm-9 ">
																<input type="text" class="form-control col-md-10"
																	id="todayDate"
																	th:value="${#dates.format(date, 'yyyy-MM-dd')}"
																	readonly="readonly">
															</div>
														</div>

														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">使用者</label>
															<div class="col-md-9 col-sm-9 ">
																<input type="text" name="rentUser" id="rentUser"
																	class="form-control col-md-10" />
															</div>
														</div>
														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">用途</label>
															<div class="col-md-9 col-sm-9 ">
																<input type="text" class="form-control col-md-10"
																	id="purpose" value="勤務">
															</div>
														</div>
														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">場所</label>
															<div class="col-md-9 col-sm-9 ">
																<input type="text" id="storageLocation" value="自社"
																	class="form-control col-md-10">
															</div>
														</div>
														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">特記事項</label>

															<div class="col-md-9 col-sm-9 ">
																<input type="text" id="speciality"
																	class="form-control col-md-10">
															</div>
														</div>
														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">分類</label>
															<div class="col-md-9 col-sm-9 "
																th:if="${kubunCode} != null">
																<select class="form-control" id="singleSelect"
																	name="selectedItem" onchange="getSubItem()">
																	<option value="">選択</option>
																	<option th:each="productKindCode : ${kubun}"
																		th:value="${productKindCode.codeDetailId}"
																		th:text="${productKindCode.codeDetailName}"></option>
																</select>

															</div>
															<p th:unless="${kubunCode} != null">データがありません</p>
														</div>
														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">種類</label>

															<div class="col-md-9 col-sm-9 ">

																<select class="select2_multiple form-control"
																	id="sub_singleSelect" name="sub_selectedItem"
																	onchange="getSubSubItem()">

																	<option value="">選択</option>
																</select>

															</div>

														</div>


														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">選択</label>
															<div class="col-md-9 col-sm-9 ">
																<select class="select2_multiple form-control"
																	id="sub_subSelect" name="selectedSubItem">

																	<option value="">選択</option>


																</select>
															</div>
														</div>
														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">貸与期間</label>

															<div class="col-md-9 col-sm-9 ">
																<div class="col-md-9">
																	<div class="input-group date" id="myDatepicker"
																		name="myDatepicker">
																		<input type="text"
																			th:value="${#dates.format(date, 'yyyy-MM-dd')}"
																			class="form-control" name="returnPeriod"
																			id="returnPeriod"> <span
																			class="input-group-addon"> <span
																			class="glyphicon glyphicon-calendar"></span>
																		</span>
																	</div>
																</div>


															</div>
														</div>
														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">BP社名</label>
															<div class="col-md-9 col-sm-9 ">
																<input type="text" id="bpName"
																	class="form-control col-md-10">
															</div>
														</div>
														<div>
															<input type="button" class="btn btn-danger" id="button1"
																onclick="writeItem();" value="追加" />
														</div>


														<div class="form-group row">
															<label class="control-label col-md-3 col-sm-3 ">貸与目録</label><br>
														</div>
														<div class="form-group row">
															<table id="selectedAsset">
																<thead>
																	<tr>

																		<th class="col-md-1" id="rentalUser_insert">貸与者</th>
																		<th class="col-md-1" id="codeDetailName_insert">分類</th>
																		<th class="col-md-1" id="item1_insert">種類</th>
																		<th class="col-md-1" id="assetNumber_insert">管理番号</th>
																		<th class="col-md-1" id="purpose_insert">用途</th>
																		<th class="col-md-1" id="storageLocation_insert">場所</th>
																		<th class="col-md-1" id="speciality_insert">特記事項</th>
																		<th class="col-md-1" id="returnPeriod_insert">返却期間</th>
																		<th class="col-md-1" id="bpName_insert">BP社名</th>
																		<th class="col-md-1" id="cancel_insert">取消</th>
																	</tr>
																</thead>
																<tbody></tbody>
															</table>

														</div>


													</div>
												</div>


												<hr>


												<div class="modal-footer">
													<input type="button" class="btn btn-danger"
														id="insertButton" value="貸与" onclick="rentalItem();" />
													<button type="button" class="btn btn-secondary"
														onclick="cancelInsert();" data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<!-- /insert modal -->

								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /page content -->

			<!-- footer content -->
			<div th:insert="/fragments/footer :: footer" th:remove="tag"></div>
			<!-- /footer content -->
		</div>
	</div>

	<!-- jQuery -->
	<script src="../vendors/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap -->
	<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- jquery-ui -->
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<!-- DataTable -->
	<script th:src="@{/DataTables-1.10.20/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/DataTables-1.10.20/js/dataTables.bootstrap4.min.js}"></script>

	<!-- FastClick -->
	<script src="../vendors/fastclick/lib/fastclick.js"></script>
	<!-- NProgress -->
	<script src="../vendors/nprogress/nprogress.js"></script>
	<!-- iCheck -->
	<script src="../vendors/iCheck/icheck.min.js"></script>
	<!-- bootstrap-datetimepicker -->
	<script src="../vendors/moment/min/moment.min.js"></script>
	<script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
	<script
		src="../vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
	<!-- Custom Theme Scripts -->
	<script src="../build/js/custom.min.js"></script>

	<!-- page script -->
	<script th:inline="javascript">
    /*<![CDATA[*/

        var modalesectiondata = null;

    	var kubunCodeMap = new Map();
    	var kubunItemMap = new Map();
    	/*listで区分コードを呼び出す  */
		var kubunCode = /*[[${kubunCode}]]*/;
		/* keyはitem1でcodeDetailNameがvalueになるmapを作る */
		kubunCode.forEach(function( value ) {

			kubunCodeMap.set(value.item1,value.codeDetailName);

    	});
		/* keyはcodeDetailIdでcodeDetailNameがvalueになるmapを作る */
		kubunCode.forEach(function( value ) {

		kubunItemMap.set(value.codeDetailId, value.codeDetailName);});
    	var statusCodeMap = new Map();
    	/*listで状態コードを呼び出す  */
    	var statusCode = /*[[${statusCode}]]*/;
    	/* keyはcodeDetailIdでcodeDetailNameがvalueになるmapを作る */
    	statusCode.forEach(function( value ) {

    		statusCodeMap.set(value.codeDetailId, value.codeDetailName);
    	});

function cancelInsert(){

/*削除する前に確認する  */
	 var result = confirm('削除しますか？');
	 /*もしyesであれば#selectedAssetのtbodyにあるデータのassetSeqを元にしてassetテーブルのstatus_codeを001に変える  */
	 if(result) {
		 var tr =$('#selectedAsset tbody');


			var rental =new Object();
			var tdArr = new Array();
			var tr = $('#selectedAsset tbody tr');
			var td =  $('#selectedAsset tbody tr td');
			tr.each(function(i){

				var assetSeq=td.eq(8).text();

			$.ajax({
					"url" : "/rental/cancelAsset",
				"type" : "post",
			 		"dataType": "json",
					"data" : assetSeq,
					"contentType": "application/JSON"
			});


			});

		 //yes location.replace('index.php');
	 } else {
		 //no

	 }




}

        $(function(){
        	/*一つの日付を選べるカーレンダーのフォーマットを決める  */
            $('#rentalDay_search').datetimepicker({
                format: 'YYYY-MM-DD'
            });
            $('#myDatepicker').datetimepicker({
                format: 'YYYY-MM-DD'
            });

            $('#returnPeriod_search').datetimepicker({
                format: 'YYYY-MM-DD'
            });

            /*二つ一つの日付を選べるカーレンダーのフォーマットを決める  */
        	$('#rental_search').daterangepicker({
				startDate: moment().add(-1, "months"),
				endDate: moment(),
			 locale: {
			       format: 'YYYY/MM/DD'
			   }, function(start, end, label) {
			       console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
			   }
			});
        	/*カーレンダーで期間を無くして今貸与されてるものを全部見えることにする */
        	$('#rental_search').val('');
       
            var modalesectiontable = $("#table1").DataTable({
 
            	"language": {
            		"info":           "表示 _START_ ~ _END_ の _TOTAL_ エントリ",
            		"infoEmpty":      "表示 0 ~ 0 の 0 エントリ",
            	    "infoFiltered":   "",
            	    "paginate": {
            	        "first":      "最初",
            	        "last":       "最後",
            	        "next":       "次へ",
            	        "previous":   "前の"
            	    }
                },
            	fixedHeader: true,
            	"processing": true,
            	"serverSide": true,
            	"start": 0,
                "length": 10,
                "searching": false,
                "paging": true,
                "lengthChange": false,
                "ordering": false,
			
                "ajax": {
                	url: /*[[@{/rental/getRentalList}]]*/ 'rental/getRentalList',
                	type: "POST",
                	dataType: "json",
                	contentType: 'application/JSON',
                	data: function ( d ) {

                		d.columns[0].search.value = $('#assetNumber_search').val();
                   		d.columns[1].search.value = $('#rental_search').val();
                        return JSON.stringify(d);
                    }
                },

                "columnDefs": [

	
                	{ targets: 0, data: "rentalNo"},

                    { targets: 1, data: "assetNumber"},

                    { targets: 2, data: function ( d ) {
                    	return kubunItemMap.get(d.kubunCode);
                    }},

                    { targets: 3, data: "storageLocation"},

                    { targets: 4, data: "rentalUserId"},

                    { targets: 5, data: function ( d ) {
                    	var str = d.rentalDay;
                    	return str.substring(0, 4) + "-" + str.substring(4, 6) + "-" + str.substring(6, 8);
                    }},

                    { targets: 6, data: function ( d ) {
                    	var str = d.returnPeriod;
                    	return str.substring(0, 4) + "-" + str.substring(4, 6) + "-" + str.substring(6, 8);
                    }},

                    { targets: 7,
                    	data: "description",
                        render: function ( data, type, row, meta ) {
     
                          return '<button type="button" class="btn btn-warning" id="updateButton" onclick = "researchRental(' + row.assetSeq + ')" >更新</button><button type="button"id="deleteButton" class="btn btn-danger" onclick = "deleteAsset(' + row.assetSeq + ')">返却</button>';

                           }
                    }

                ]
            });



            /*assetNumberを貰ってメイン画面のデータを変える*/
            $('#assetNumber_search').on( 'keyup', function () {
            	modalesectiontable
                .column(0)
                .search( this.value )
                .draw();
            } );
            /*rental_dayを貰ってメイン画面のデータを変える*/
            $("#rental_search").change(function () {
                var date = $("#rental_search").val();
                alert(date);
                modalesectiontable
                .column(1)
                .search(date)
                .draw();
            });


        })
    /*]]>*/
    </script>


	<script th:inline="javascript">
	/*<![CDATA[*/
/*データのupdateメソッド
引数はrentalのドメインを作ってajaxを利用する
戻り値も無し
*/
function updateRental(){
		/*変更してもらったデータにもし-の文字があればなくすメソッド  */
	 String.prototype.replaceAll = function(org, dest) {
		    return this.split(org).join(dest);
		}
	var rental = new Object();
	rental.rentalNo=$('#rentalNo_view').val();
	rental.assetNumber=$('#assetNumber_view').val();
	rental.codeDetailName=$('#codeDetailName_view').val();
	rental.purpose=$('#purpose_view').val();
	rental.storageLocation=$('#storageLocation_view').val();
	rental.rentalDay=$('#rentalDay_view').val().replaceAll("-","");
	rental.speciality=$('#speciality_view').val();
	rental.returnPeriod=$('#returnPeriod_view').val().replaceAll("-","");
	rental.rentalUserId=$('#rentalUserId_view').val();
	rental.bpName=$('#bpName_view').val();
	rental.applicantId=$('#applicantId_view').val();
	rental.assetSeq=$('#assetSeq_hidden').val();

    		$.ajax({
 			   type  : "POST",
 			   url : "/rental/updateRental",
 				dataType : "json",
 				"contentType" : "application/JSON",
 				data : JSON.stringify(rental)


 	});
/*変更してページをリロードする  */
			location.reload(true);

	}

function researchRental(assetSeq){



	$.ajax({
		   type  : "POST",
		   url : "/rental/researchRental",
			dataType : "json",
			"contentType" : "application/JSON",
			data : JSON.stringify(assetSeq),
			success : function(data){

				var returnPeriod=data.returnPeriod;
				returnPeriod=returnPeriod.substring(0, 4) + "-" + returnPeriod.substring(4, 6) + "-" + returnPeriod.substring(6, 8);
				var	rentalDay=data.rentalDay;
				rentalDay=rentalDay.substring(0, 4) + "-" + rentalDay.substring(4, 6) + "-" + rentalDay.substring(6, 8);
			$('#rentalNo_view').val(data.rentalNo);
			$('#assetNumber_view').val(data.assetNumber);
			$('#codeDetailName_view').val(kubunItemMap.get(data.kubunCode));
			$('#purpose_view').val(data.purpose);
			$('#storageLocation_view').val(data.storageLocation);
			$('#rentalDay_view').val(rentalDay);
			$('#speciality_view').val(data.speciality);
			$('#returnPeriod_view').val(returnPeriod);
			$('#rentalUserId_view').val(data.rentalUserId);
			$('#applicantId_view').val(data.applicantId);
			$('#assetSeq_hidden').val(data.assetSeq);

			}

});


	$('#modal3d').modal({backdrop: 'static'});

}

	function deleteAsset(assetSeq){

		 var result = confirm('返却しますか？');
		 /*もしyesであれば選択した行のデータを元にして貸与テーブルのデータを削除する  */
		 if(result) {
				$.ajax({
					   type  : "POST",
					   url : "/rental/returnAsset",
						dataType : "json",
						"contentType" : "application/JSON",
						data : JSON.stringify(assetSeq)


			});
				location.reload(true);

		 } else {
			 //no

		 }





		}
		function modalInsert() {


    		$('#modal3d2').modal({backdrop: 'static'});
    	}

		function getSubItem() {
			var kub =/*[[${kubunCode}]]*/;

			$('#singleSelect').click(

					function() {
						var item=$('#singleSelect option:selected').val();

							var html = '<option value="">選択</option>';
							kub.forEach(function(value) {
							if(value.item1==item){
								html += '<option value="' +value.codeDetailId + '">'
										+ value.codeDetailName + '</option>';
							}});
							$('#sub_singleSelect').html(html);
						});
		}


		function getSubSubItem() {



			$('#sub_singleSelect').click(
					function() {
					var selectedItem = $('#sub_singleSelect option:selected').val();
					selectedItem=selectedItem.replace(/[^0-9]/g,'');

					$.ajax({
	   			"url" : "/rental/getAssetList",
	    		"type" : "post",
	   	 		"dataType": "json",
	   	 		"contentType": "application/JSON",
	   			"data" : selectedItem,
	   			contentType: 'application/JSON',
	   		 	"success" : function(data){

	   			var itemName=$('#sub_subSelect').val();
				var html = '<option value="">選択</option>';

				data.forEach(function(value) {

					html += '<option value="' + value.assetSeq + '">'
							+ value.assetNumber + '</option>';
				});
				$('#sub_subSelect').html(html);
			}


	});
					}
);

      }



 function deleteRow(btn) {


var assetSeq=btn.value;
		$.ajax({
   			"url" : "/rental/cancelAsset",
    		"type" : "post",
   	 		"dataType": "json",
   			"data" : assetSeq,
   			"contentType": "application/JSON"
		});
  var row = btn.parentNode.parentNode;
  row.parentNode.removeChild(row);

}
 function rentalItem() {
	 String.prototype.replaceAll = function(org, dest) {
		    return this.split(org).join(dest);
		}



		var rental =new Object();
		var tdArr = new Array();
		var tr = $('#selectedAsset tbody tr');
		var td =  $('#selectedAsset tbody tr td');
		tr.each(function(i){
			rental.rentalUserId = td.eq(0).text();
			rental.assetNumber = td.eq(3).text();
			rental.purpose = td.eq(4).text();
			rental.storageLocation = td.eq(5).text();
			rental.speciality = td.eq(6).text();
			rental.returnPeriod = td.eq(7).text().replaceAll("-","");
			rental.assetSeq=td.eq(8).text();
			rental.applicantId = /*[[${session.id}]]*/ 'id';
			rental.rentalDay=$('#todayDate').val().replaceAll("-","");
			rental.bpName=td.eq(9).text();

			tdArr.push(rental);
		});

	$.ajax({
		"url" : "/rental/addRental",
		"type" : "post",
		"dataType": "json",
		"contentType": "application/JSON",
		"data" : JSON.stringify(tdArr)

});
	location.reload(true);
 }
	function writeItem() {

		if($('#rentUser').val()!=""&&$('#returnPeriod').val()!=""){
			var number=$("#sub_subSelect option:selected").text();
			$.ajax({
			   			"url" : "/rental/getAsset",
			    		"type" : "post",
			   	 		"dataType": "json",
			   			"data" : number,
			   			"contentType": "application/JSON",
			   		 	"success" : function(data){

			   		 	$('#selectedAsset tbody').append('<tr><td>'
			   					+$('#rentUser').val()+
			   					'</td><td>'
			   					+$("#singleSelect option:selected").val()+
			   					'</td><td>'
			   				+$("#sub_singleSelect option:selected").text()+
			   					'</td><td>'
			   				+data.assetNumber+

			   					'</td><td>'
			   					+$("#purpose").val()+
			   					'</td><td>'
			   					+$("#storageLocation").val()+
			   					'</td><td>'
			   					+$("#speciality").val()+
			   					'</td><td>'
			   					+$("#returnPeriod").val()+
			   					'</td><td style="display:none;"> '
				   				+data.assetSeq+
				   				'</td><td>'
			   					+$("#bpName").val()+
			   					'</td><td><button value="'+data.assetSeq+'" class="btn btn-warning" id="cancelitem" onclick="deleteRow(this)">Delete</button></td></tr>');

			    },
				"Error" : function(){
					alert("貸与不可能");
				}
			});
	}else{
		alert("使用者入力");}

		}
		/*]]>*/
	</script>

</body>
</html>