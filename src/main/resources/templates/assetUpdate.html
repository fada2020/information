<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>IT資産管理</title>

    <!-- favicons -->
	<link rel="icon" href="../images/aisRogo.png">
    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
	<link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">

    <!-- bootstrap-datetimepicker -->
    <link href="../vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">

    <style>
    	#table1, #table2, thead, th {text-align: center;}
		.my-custom-scrollbar {
			position: relative;
			height: 200px;
			overflow: auto;
		}
		.table-wrapper-scroll-y {
			display: block;
		}
		.error {
	      color: red;
	      background-color: lavender;
		}
	</style>

  </head>
  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
      	<!-- sidebar -->
		<div th:insert="/fragments/sidebar :: sidebar" th:remove="tag"></div>
        <!-- sidebar -->

        <!-- top navigation -->
        <div th:insert="/fragments/top_nav :: top_nav" th:remove="tag"></div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>IT資産情報修正</h3>
              </div>
            </div>

            <div class="clearfix"></div>

            <div class="row">

            <!-- 資産情報修正フォーム -->
            <form action="/asset/update" id="updateForm" method="POST" role="form" class="form-horizontal">
            <div class="x_panel">
            	<div class="x_content" style="display: block;">
	            	<div class="row well">
			  			<div class="col-md-6">
			  				<div class="row">
			  					<div class="col-md-2">
			  						<span>管理番号</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="hidden" class="form-control" name="assetSeq" th:value="${asset.assetSeq}">
					  				<input type="text" class="form-control" name="assetNumber" th:value="${asset.assetNumber}">
					  			</div>
					  			<div class="col-md-2">
					  				<span>区分</span>
					  			</div>
					  			<div class="col-md-4">
				                	<select name="kubunCode" class="form-control" id="psNum_search">
				                		<option th:each="code : ${productCode}" th:value="${code.codeDetailId}" th:selected="${code.codeDetailId == asset.kubunCode}"
				                		th:inline="text">[[${code.codeDetailName}]]</option>
									</select>
					  			</div>
			  				</div>
			  			</div>
			  			<div class="col-md-6">
			  				<div class="row">
			  					<div class="col-md-2">
				  					<span>購入日</span>
				  				</div>
				  				<div class="col-md-4">
								<div class="input-group date" id="myDatepicker">
									<input type="text" class="form-control" name="purchaseDate" th:value="${asset.purchaseDate}">
									<span class="input-group-addon">
									<span class="glyphicon glyphicon-calendar"></span>
								 </span>
								</div>
				  				</div>
				  				<div class="col-md-2">
				  					<span>保証期間</span>
				  				</div>
				  				<div class="col-md-4">
				  					<input type="text" class="form-control numVal" name="warrantyPeriod" th:value="${asset.warrantyPeriod}">
				  				</div>
			  				</div>
			  			</div>

			  			<div class="col-md-6">
			  				<div class="row">
			  					<div class="col-md-2">
			  						<span>購入先</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control" name="buyTo" th:value="${asset.buyTo}">
			  					</div>
			  					<div class="col-md-2">
			  						<span>購入金額</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control numVal" name="purchasePrice" th:value="${asset.purchasePrice}">
			  					</div>
			  				</div>
			  			</div>
			  			<div class="col-md-6">
			  				<div class="row">
			  					<div class="col-md-2">
			  						<span>保管位置</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control" name="storageLocation" th:value="${asset.storageLocation}">
			  					</div>
			  					<div class="col-md-2">
			  						<span>状態</span>
			  					</div>
			  					<div class="col-md-4">
				                	<select name="statusCode" class="form-control" id="sNumber_search">
				                		<option th:each="code : ${stateCode}" th:value="${code.codeDetailId}" th:selected="${code.codeDetailId == asset.statusCode}"
				                		th:inline="text">[[${code.codeDetailName}]]</option>
									</select>
			  					</div>
			  				</div>
			  			</div>

			  			<div class="col-md-12"><br></div>

			  			<div class="col-md-6">
			  				<div class="row">
			  					<div class="col-md-2">
			  						<span>Maker</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control" name="makerName" th:value="${asset.makerName}">
			  					</div>
			  					<div class="col-md-2">
			  						<span>Model</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control" name="modelName" th:value="${asset.modelName}">
			  					</div>
			  				</div>
			  			</div>
			  			<div class="col-md-6">
			  				<div class="row">
			  					<div class="col-md-2">
			  						<span>S/N</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control" name="serialNum" th:value="${asset.serialNum}">
			  					</div>
			  					<div class="col-md-2">
			  						<span>I/F</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control" name="interFaceCol" th:value="${asset.interFaceCol}">
			  					</div>
			  				</div>
			  			</div>
			  			<div class="col-md-12">
			  				<br>
			  				<span>その他</span>
			  			</div>
			  			<div class="col-md-12">
			  				<input type="text" class="form-control" name="other" th:value="${asset.other}">
			  			</div>
					</div>
					<div class="row well">
			  			<div class="col-md-12">
			  				<span>OS</span>
			  			</div>
			  			<div class="col-md-12">
			  				<br>
			  			</div>
			  			<div class="col-md-2">
			  				<span>名(Edition)</span>
			  			</div>
			  			<div class="col-md-4">
			  				<input type="text" class="form-control" name="osName" th:value="${asset.osName}">
			  			</div>
			  			<div class="col-md-2">
			  				<span>Product Key</span>
			  			</div>
			  			<div class="col-md-4">
			  				<input type="text" class="form-control" name="osProductKey" th:value="${asset.osProductKey}">
			  			</div>
					</div>
					<div class="row well">
			  			<div class="col-md-12">
			  				<span>CPU</span>
			  			</div>
			  			<div class="col-md-12">
			  				<br>
			  			</div>
			  			<div class="col-md-2">
			  				<span>Processor</span>
			  			</div>
			  			<div class="col-md-4">
			  				<input type="text" class="form-control" name="cpuProcessor" th:value="${asset.cpuProcessor}">
			  			</div>
			  			<div class="col-md-2">
			  				<span>動作周波数</span>
			  			</div>
			  			<div class="col-md-4">
			  				<input type="text" class="form-control numVal" name="operatingFrequency" th:value="${asset.operatingFrequency}">
			  			</div>
		  			</div>
		  			<div class="row well">
			  			<div class="col-md-6">
			  				<div class="row well">
			  					<div class="col-md-12">
			  						<span>Memory</span>
			  					</div>
					  			<div class="col-md-12">
					  				<br>
					  			</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control numVal" name="memory" th:value="${asset.memory}">
			  					</div>
			  					<div class="col-md-4">
			  						<span>Upgarde</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control numVal" name="memoryUpgarde" th:value="${asset.memoryUpgarde}">
			  					</div>
			  				</div>
			  			</div>
			  			<div class="col-md-6">
			  				<div class="row well">
			  					<div class="col-md-12">
			  						<span>HDD</span>
			  					</div>
					  			<div class="col-md-12">
					  				<br>
					  			</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control numVal" name="hdd" th:value="${asset.hdd}">
			  					</div>
			  					<div class="col-md-4">
			  						<span>Upgarde</span>
			  					</div>
			  					<div class="col-md-4">
			  						<input type="text" class="form-control numVal" name="hddUpgarde" th:value="${asset.hddUpgarde}">
			  					</div>
			  				</div>
			  			</div>
		  			</div>
					<div class="row well">
			  			<div class="col-md-12">
			  				<span>MAC</span>
			  			</div>
			  			<div class="col-md-12">
			  				<br>
			  			</div>
			  			<div class="col-md-3">
			  				<span>LAN</span>
			  			</div>
			  			<div class="col-md-3">
			  				<input type="text" class="form-control" name="macLan" th:value="${asset.macLan}">
			  			</div>
			  			<div class="col-md-3">
			  				<span>Wireless</span>
			  			</div>
			  			<div class="col-md-3">
			  				<input type="text" class="form-control" name="macWireless" th:value="${asset.macWireless}">
			  			</div>
					</div>
		  			<div class="row well">
			  			<div class="col-md-12">
			  				<span>Security</span>
			  			</div>
			  			<div class="col-md-12">
			  				<br>
			  			</div>
			  			<div class="col-md-3">
			  				<span>BIOS</span>
			  			</div>
			  			<div class="col-md-3">
			  				<input type="text" class="form-control" name="securityBios" th:value="${asset.securityBios}">
			  			</div>
			  			<div class="col-md-3">
			  				<span>HDD</span>
			  			</div>
			  			<div class="col-md-3">
			  				<input type="text" class="form-control" name="securityHdd" th:value="${asset.securityHdd}">
			  			</div>
					</div>
					<div class="row well">
			  			<div class="col-md-12">
			  				<span>Admin.Account</span>
			  			</div>
			  			<div class="col-md-12">
			  				<br>
			  			</div>
			  			<div class="col-md-3">
			  				<span>ID</span>
			  			</div>
			  			<div class="col-md-3">
			  				<input type="text" class="form-control" name="adminAccountId" th:value="${asset.adminAccountId}">
			  			</div>
			  			<div class="col-md-3">
			  				<span>PW</span>
			  			</div>
			  			<div class="col-md-3">
			  				<input type="text" class="form-control" name="adminAccountPwd" th:value="${asset.adminAccountPwd}">
			  			</div>
		  			</div>
		  			<div class="col-md-12 text-right">
		  				<br>
		  				<button type="button" class="btn btn-primary" onclick = "location.href ='/asset'">戻る</button>
		  				<button type="button" id="updateProc" class="btn btn-primary pull-right">修正</button>
		  			</div>
		  			<div class="col-md-12">
		  				<br>
		  			</div>
		  		</div>
	  		</div>
	  		</form>
	  		<!-- /資産情報修正フォーム -->

				<!-- 付属品テーブル -->
				<div class="row">
			  		<div class="col-md-12">
			  			<div class="x_panel">
							<div class="x_title">
								<h2>付属品</h2>
								<div class="clearfix"></div>
							</div>
							<div class="x_content" style="display: block;">
								<div class="table-responsive table-wrapper-scroll-y my-custom-scrollbar">
									<table class="table table-striped jambo_table bulk_action text-center" id="table1">
										<thead>
											<tr class="headings">
												<th class="col-md-1">No </th>
												<th class="col-md-2">品名 </th>
												<th class="col-md-2">仕樣 </th>
												<th class="col-md-1">数量 </th>
												<th class="col-md-6">備考 </th>
												<th colspan="2"></th>
											</tr>
										</thead>
										<tbody>
											<tr class="even pointer">
												<td></td>
												<td><input id="itemName" type="text" maxlength="25" class="form-control"></td>
												<td><input id="itemSpec" type="text" maxlength="25" class="form-control"></td>
												<td><input id="itemQuantity" type="text" maxlength="11" class="form-control"></td>
												<td><input id="remarks" type="text" maxlength="100" class="form-control"></td>
												<td colspan="2" class="a-center">
													<a id="addAccessories" class="btn btn-info btn-xs"><i class="fa fa-plus-square"></i></a>
												</td>
											</tr>
											<tr th:each="accessories : ${asset.accessoriesList}">
												<td id="accessoriesSeq" th:text="${accessories.accessoriesSeq}"></td>
												<td><input type="text" maxlength="25" class="form-control" id="itemName" th:value="${accessories.itemName}"></td>
												<td><input type="text" maxlength="25" class="form-control" id=itemSpec th:value="${accessories.itemSpec}"></td>
												<td><input type="text" maxlength="11" class="form-control" id="itemQuantity" th:value="${accessories.itemQuantity}"></td>
												<td><input type="text" maxlength="100" class="form-control" id="remarks" th:value="${accessories.remarks}"></td>
												<td class="a-center"><a id="updateAccessories" class="btn btn-warning btn-xs"><i class="fa fa-cog"></i></a></td>
												<td class="a-center"><a id="deleteAccessories" class="btn btn-danger btn-xs"><i class="fa fa-trash"></i></a></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
			  		</div>
		  		</div>
				<!-- /付属品テーブル -->

				<!-- 保守履歴テーブル -->
				<div class="row">
			  		<div class="col-md-12">
			  			<div class="x_panel">
							<div class="x_title">
								<h2>保守履歴</h2>
								<div class="clearfix"></div>
							</div>
							<div class="x_content" style="display: block;">
								<div class="table-responsive table-wrapper-scroll-y my-custom-scrollbar">
									<table class="table table-striped jambo_table bulk_action" id="table2">
										<thead>
											<tr class="headings">
												<th class="col-md-1">No </th>
												<th class="col-md-2">実施日 </th>
												<th class="col-md-5">実施内容 </th>
												<th class="col-md-2">担当 </th>
												<th class="col-md-2">承認 </th>
												<th colspan="2"></th>
											</tr>
										</thead>
										<tbody>
											<tr class="even pointer">
												<td></td>
												<td><input id="implementationDate" maxlength="8" type="text" class="form-control"></td>
												<td><input id="implementationDetail" maxlength="100" type="text" class="form-control"></td>
												<td><input id="repId" maxlength="10" type="text" class="form-control"></td>
												<td><input id="approverId" maxlength="10" type="text" class="form-control"></td>
												<td colspan="2" class="a-center">
													<a id="addMaintenanceHistory" class="btn btn-info btn-xs"><i class="fa fa-plus-square"></i></a>
												</td>
											</tr>
											<tr th:each="maintenance : ${asset.maintenanceHistoryList}">
												<td id="historySeq" th:text="${maintenance.historySeq}"></td>
												<td><input type="text" maxlength="8" class="form-control" id="implementationDate" th:value="${maintenance.implementationDate}"></td>
												<td><input type="text" maxlength="100" class="form-control" id="implementationDetail" th:value="${maintenance.implementationDetail}"></td>
												<td><input type="text" maxlength="10" class="form-control" id=repId th:value="${maintenance.repId}"></td>
												<td><input type="text" maxlength="10" class="form-control" id="approverId" th:value="${maintenance.approverId}"></td>
												<td class="a-center"><a id="updateMaintenanceHistory" class="btn btn-warning btn-xs"><i class="fa fa-cog"></i></a></td>
												<td class="a-center"><a id="deleteMaintenanceHistory" class="btn btn-danger btn-xs"><i class="fa fa-trash"></i></a></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
			  		</div>
		  		</div>
				<!-- /保守履歴テーブル -->
		  	</div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <div th:insert="/fragments/footer :: footer" th:remove="tag"></div>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- jquery-ui -->
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<!-- DataTable -->
	<script th:src="@{/DataTables-1.10.20/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/DataTables-1.10.20/js/dataTables.bootstrap4.min.js}"></script>

    <!-- jquery-validation-1.19.1 -->
    <script src="../vendors/jquery-validation-1.19.1/dist/jquery.validate.min.js"></script>

    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- bootstrap-datetimepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>

    <!-- page script -->
    <script th:inline="javascript">
    /*<![CDATA[*/

    	// datetimepickerセッティング
        $('#myDatepicker').datetimepicker({
            format: 'YYYY-MM-DD'
        });

		// 区分コードMap
    	var productCodeMap = new Map();
		var productCode = /*[[${productCode}]]*/;
    	productCode.forEach(function( value ) {
    		productCodeMap.set(value.codeDetailId, value.codeDetailName);
    	});
    	// 状態コードMap
    	var stateCodeMap = new Map();
    	var stateCode = /*[[${stateCode}]]*/;
    	stateCode.forEach(function( value ) {
    		stateCodeMap.set(value.codeDetailId, value.codeDetailName);
    	});

    	// Jquery validator メッセージセッティング
    	$.validator.messages.number = '有効な数字を入力';
    	$.validator.messages.maxlength = '{0} 文字以下を入力';

        $(function(){

        	// 数量文字入力制限
        	$('#table1 tbody').on('keyup','#itemQuantity', function() {
        	    if (/\D/.test(this.value)) {
        	        this.value = this.value.replace(/\D/g, '')
        	        alert('半角数字のみ入力');
        	    }
        	});

        	// 実施日文字入力制限
        	$('#table2 tbody').on('keyup','#implementationDate', function() {
        	    if (/\D/.test(this.value)) {
        	        this.value = this.value.replace(/\D/g, '')
        	        alert('半角数字のみ入力');
        	    }
        	});

			// 付属品登録プロセス
            $('#addAccessories').on('click', function () {
            	var selectTr = $(this).closest("tr");

            	var accessories ={
            			"assetSeq" : /*[[${asset.assetSeq}]]*/,
            			"itemName" : selectTr.find("#itemName").val(),
            			"itemSpec" : selectTr.find("#itemSpec").val(),
            			"itemQuantity" : selectTr.find("#itemQuantity").val(),
            			"remarks" : selectTr.find("#remarks").val()
            	};

                $.ajax({
                    url: /*[[@{/asset/addAccessories}]]*/ 'asset/addAccessories',
                    type: "POST",
                    dataType: "json",
                    contentType: 'application/JSON',
                    data : JSON.stringify(accessories),
                    success: function(data) {
                    	if(data.accessoriesSeq == 0){
    						alert('エラーが発生しました。');
    					}else {
    						 $('#table1 tbody').append(
    								 '<tr>'
    								 +'<td id="accessoriesSeq">'+data.accessoriesSeq+'</td>'
    								 +'<td><input type="text" maxlength="25" class="form-control" id="itemName" value="'+data.itemName+'"></td>'
    								 +'<td><input type="text" maxlength="25" class="form-control" id="itemSpec" value="'+data.itemSpec+'"></td>'
    								 +'<td><input type="text" maxlength="11" class="form-control" id="itemQuantity" value="'+data.itemQuantity+'"></td>'
    								 +'<td><input type="text" maxlength="100" class="form-control" id="remarks" value="'+data.remarks+'"></td>'
    								 +'<td class="a-center"><a id="updateAccessories" class="btn btn-warning btn-xs"><i class="fa fa-cog"></i></a></td>'
    								 +'<td class="a-center"><a id="deleteAccessories" class="btn btn-danger btn-xs"><i class="fa fa-trash"></i></a></td>'
    								 +'</tr>'
    						 );
    						 alert('追加されました。');
    					}
                    },
                    // 通信失敗時の処理
                    error: function(xhr, textStatus, error) {
                    	alert('通信失敗');
                    }
                });

            });

			// 付属品修正プロセス
            $('#table1 tbody').on("click","#updateAccessories", function() {
            	var selectTr = $(this).closest("tr");

            	var accessories ={
            			"assetSeq" : /*[[${asset.assetSeq}]]*/,
            			"accessoriesSeq" : selectTr.find("#accessoriesSeq").text(),
            			"itemName" : selectTr.find("#itemName").val(),
            			"itemSpec" : selectTr.find("#itemSpec").val(),
            			"itemQuantity" : selectTr.find("#itemQuantity").val(),
            			"remarks" : selectTr.find("#remarks").val()
            	};

            	$.ajax(/*[[@{/asset/updateAccessories}]]*/ 'asset/updateAccessories',
					{
						type: "POST",
						dataType: "json",
						contentType: 'application/JSON',
						data : JSON.stringify(accessories)
					}
            	)
				.success(function(result) {
					if(result == 0) {
						alert('エラーが発生しました。');
					} else {
						alert('修正されました。');
					}
				}).error(function(xhr, textStatus, error) {
                	alert('通信失敗');
                });

            });

			// 付属品削除プロセス
            $('#table1 tbody').on("click","#deleteAccessories", function() {

            	if(!confirm('本当に削除しますか？')){
                    /* キャンセルの時の処理 */
                    return false;
                }else{
                	var selectTr = $(this).closest("tr");

                	var accessories ={
                			"assetSeq" : /*[[${asset.assetSeq}]]*/,
                			"accessoriesSeq" : selectTr.find("#accessoriesSeq").text()
                	};

                	$.ajax(/*[[@{/asset/deleteAccessories}]]*/ 'asset/deleteAccessories',
    					{
    						type: "POST",
    						dataType: "json",
    						contentType: 'application/JSON',
    						data : JSON.stringify(accessories)
    					}
                	)
    				.success(function(result) {
    					if(result == 0) {
    						alert('エラーが発生しました。');
    					} else {
    						selectTr.remove();
    					}
    				}).error(function(xhr, textStatus, error) {
                    	alert('通信失敗');
                    });
                }

            });

			// 保守履歴登録プロセス
            $('#addMaintenanceHistory').on('click', function () {
            	var selectTr = $(this).closest("tr");

            	var maintenanceHistory ={
            			"assetSeq" : /*[[${asset.assetSeq}]]*/,
            			"implementationDate" : selectTr.find("#implementationDate").val(),
            			"implementationDetail" : selectTr.find("#implementationDetail").val(),
            			"repId" : selectTr.find("#repId").val(),
            			"approverId" : selectTr.find("#approverId").val()
            	};

            	$.ajax(/*[[@{/asset/addMaintenanceHistory}]]*/ 'asset/addMaintenanceHistory',
					{
						type: "POST",
						dataType: "json",
						contentType: 'application/JSON',
						data : JSON.stringify(maintenanceHistory)
					}
				)
				.success(function(data) {
					if(data.historySeq == 0){
						alert('エラーが発生しました。');
					}else {
						 $('#table2 tbody').append(
								 '<tr>'
								 +'<td id="historySeq">'+data.historySeq+'</td>'
								 +'<td><input type="text" maxlength="8" class="form-control" id="implementationDate" value="'+data.implementationDate+'"></td>'
								 +'<td><input type="text" maxlength="100" class="form-control" id="implementationDetail" value="'+data.implementationDetail+'"></td>'
								 +'<td><input type="text" maxlength="10" class="form-control" id="repId" value="'+data.repId+'"></td>'
								 +'<td><input type="text" maxlength="10" class="form-control" id="approverId" value="'+data.approverId+'"></td>'
								 +'<td class="a-center"><a id="updateMaintenanceHistory" class="btn btn-warning btn-xs"><i class="fa fa-cog"></i></a></td>'
								 +'<td class="a-center"><a id="deleteMaintenanceHistory" class="btn btn-danger btn-xs"><i class="fa fa-trash"></i></a></td>'
								 +'</tr>'
						 );
						 alert('追加されました。');
					}
				}).error(function(xhr, textStatus, error) {
                	alert('通信失敗');
                });

            });

			// 保守履歴修正プロセス
            $('#table2 tbody').on("click","#updateMaintenanceHistory", function() {
            	var selectTr = $(this).closest("tr");

            	var maintenanceHistory ={
            			"assetSeq" : /*[[${asset.assetSeq}]]*/,
            			"historySeq" : selectTr.find("#historySeq").text(),
            			"implementationDate" : selectTr.find("#implementationDate").val(),
            			"implementationDetail" : selectTr.find("#implementationDetail").val(),
            			"repId" : selectTr.find("#repId").val(),
            			"approverId" : selectTr.find("#approverId").val()
            	};

            	$.ajax(/*[[@{/asset/updateMaintenanceHistory}]]*/ 'asset/updateMaintenanceHistory',
					{
						type: "POST",
						dataType: "json",
						contentType: 'application/JSON',
						data : JSON.stringify(maintenanceHistory)
					}
            	)
				.success(function(result) {
					if(result == 0) {
						alert('エラーが発生しました。');
					} else {
						alert('修正されました。');
					}
				}).error(function(xhr, textStatus, error) {
                	alert('通信失敗');
                });

            });

			// 保守履歴削除プロセス
            $('#table2 tbody').on("click","#deleteMaintenanceHistory", function() {

            	if(!confirm('本当に削除しますか？')){
                    /* キャンセルの時の処理 */
                    return false;
                }else{
                	var selectTr = $(this).closest("tr");

                	var maintenanceHistory ={
                			"assetSeq" : /*[[${asset.assetSeq}]]*/,
                			"historySeq" : selectTr.find("#historySeq").text()
                	};

                	$.ajax(/*[[@{/asset/deleteMaintenanceHistory}]]*/ 'asset/deleteMaintenanceHistory',
    					{
    						type: "POST",
    						dataType: "json",
    						contentType: 'application/JSON',
    						data : JSON.stringify(maintenanceHistory)
    					}
                	)
    				.success(function(result) {
    					if(result == 0) {
    						alert('エラーが発生しました。');
    					} else {
    						selectTr.remove();
    					}
    				}).error(function(xhr, textStatus, error) {
                    	alert('通信失敗');
                    });
                }

            });

			// 資産修正プロセス
            $('#updateProc').on('click', function() {
                var form = $('#updateForm');

				// 有効性検査条件セッティング
                form.validate({
                    rules: {
                    	kubunCode : {
                    		required : true
                    	},
                    	purchaseDate: {
                            required: true
                        },
                        statusCode: {
                        	required: true
                        },
                        warrantyPeriod: {
                        	number: true,
                        	maxlength: 2
                        },
                        buyTo: {
                        	maxlength: 15
                        },
                        storageLocation: {
                        	maxlength: 15
                        },
                        makerName: {
                        	maxlength: 25
                        },
                        modelName: {
                        	maxlength: 25
                        },
                        serialNum: {
                        	maxlength: 25
                        },
                        interFaceCol: {
                        	maxlength: 25
                        },
                        osName: {
                        	maxlength: 25
                        },
                        osProductKey: {
                        	maxlength: 25
                        },
                        cpuProcessor: {
                        	maxlength: 25
                        },
                        purchasePrice: {
                        	number: true,
                        	maxlength: 11
                        },
                        operatingFrequency: {
                        	number: true,
                        	maxlength: 7
                        },
                        memory: {
                        	number: true,
                        	maxlength: 7
                        },
                        memoryUpgarde: {
                        	number: true,
                        	maxlength: 7
                        },
                        hdd: {
                        	number: true,
                        	maxlength: 7
                        },
                        hddUpgarde: {
                        	number: true,
                        	maxlength: 7
                        },
                        macLan: {
                        	maxlength: 25
                        },
                        macWireless: {
                        	maxlength: 25
                        },
                        other: {
                        	maxlength: 100
                        },
                        securityBios: {
                        	maxlength: 25
                        },
                        securityHdd: {
                        	maxlength: 25
                        },
                        adminAccountId: {
                        	maxlength: 25
                        },
                        adminAccountPwd: {
                        	maxlength: 25
                        }
                    },
                    messages: {
                    	kubunCode : {
                    		required : "区分を選択"
                    	},
                    	purchaseDate: {
                            required: "日付を入力"
                        },
                        statusCode: {
                        	required: "状態を選択"
                        }
                    },
                    errorPlacement: function(error, element) {
                        if (element.attr("name") == "purchaseDate") {
                          error.insertAfter("#myDatepicker");
                        } else {
                          error.insertAfter(element);
                        }
                    }
                });

				// 有効性検査成功時
                if (form.valid()) {
                	// number基本値セッティング
                    form.find('.numVal').each(function( ) {
                    	if($(this).val() == '') {
                    		$(this).val('0');
                    	}
                    });

                    // 送信
                    $.ajax({
                        url: form.attr('action'),
                        type: form.attr('method'),
                        data: form.serialize(),
                        success: function(result, textStatus, xhr) {
                        	if(result == 0){
                        		alert('エラーが発生しました。');
                        	}else{
                        		alert('修正されました。');
                        	}
                        },
                        // 通信失敗時の処理
                        error: function(xhr, textStatus, error) {
                        	alert('通信失敗');
                        }
                    });
                };

            });

        })
    /*]]>*/
    </script>

</body>
</html>