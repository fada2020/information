<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Gentelella Alela!</title>

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
	<link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- bootstrap-datetimepicker -->
    <link href="../vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">

    <style>
    	#table1 thead th{
		    text-align:center;
    	}

		#table1 tbody tr{
		    cursor:pointer;
		}
	</style>

  </head>
  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
      	<!-- sidebar -->
		<div th:insert="/fragments/sidebar :: sidebar" th:remove="tag"></div>
        <!-- sidebar -->

        <!-- top navigation -->
        <div th:insert="/fragments/top_nav :: top_nav" th:remove="tag"></div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>資産支給履歴</h3>
              </div>
            </div>

            <div class="clearfix"></div>

            <div class="row">
              <div class="col">

                <div class="col-md-1" style="width:9%;">
                    <span class="pull-right" style="margin-left:-1%; font-size: 18px;">管理番号</span>
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control" placeholder="管理番号" id="assetNumber_search" style="margin-left:-1%">
                </div>

                <div class="col-md-1" style="margin-left:-2%;">
                    <span class="pull-right" style="font-size: 18px;">貸出者</span>
                </div>
                <div class="col-md-2">
                	<input type="text" class="form-control" placeholder="貸出者" id="applicant_search" style="margin-left:-1%">
                </div>

                <div class="col-md-1" style="margin-left:-3%;">
                    <span class="pull-right" style="font-size: 18px;">状態</span>
                </div>
                <div class="col-md-2">
                	<select class="form-control" id="status_search" style="margin-left:-1%">
						<option value="-1">状態</option>
                		<option th:each="code : ${stateCode}" th:value="${code.sNumber}"
                		th:inline="text">[[${code.state}]]</option>
					</select>
                </div>

                <div class="col-md-1" style="margin-left:-2%;">
                    <span class="pull-right" style="font-size: 18px;">貸与日</span>
                </div>
                <div class="col-md-2">
					<div class="input-group date" id="myDatepicker">
						<input type="text" class="form-control" id="returnDate_search" style="margin-left:-1%">
						<span class="input-group-addon">
						<span class="glyphicon glyphicon-calendar"></span>
					 </span>
					</div>
                </div>

                <div class="col-md-1" style="width:5%; margin-left:-1%;">
                	<button id="serchButton" class="btn btn-primary">検索</button>
                </div>

                <div class="x_panel">
                  <div class="x_title">
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">

                    <table class="table table-bordered table-hover table-lg" id="table1" style="width:100%;">
                      <thead class="thead-light">
                      	<tr>
                      		<th colspan="3">装置</th>
                      		<th colspan="9">使用現況</th>
                      	</tr>
                        <tr>
                          <th>管理番号</th>
                          <th>Maker</th>
                          <th>Model</th>

                          <th>状態</th>
                          <th>貸与番号</th>
                          <th>用途</th>
                          <th>場所(Site名)</th>
                          <th>貸出者</th>
                          <th>使用者</th>
                          <th>BP社名</th>
                          <th>貸与日</th>
                          <th>返却日</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <div th:insert="/fragments/footer :: footer" th:remove="tag"></div>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- jquery-ui -->
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<!-- DataTable -->
	<script th:src="@{/DataTables-1.10.20/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/DataTables-1.10.20/js/dataTables.bootstrap4.min.js}"></script>

    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- bootstrap-datetimepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>

    <!-- page script -->
    <script th:inline="javascript">

    /*<![CDATA[*/
        $('#myDatepicker').datetimepicker({
            format: 'YYYY/MM/DD'
        });

        var modalesectiondata = null;

    	var stateCodeMap = new Map();
    	var stateCode = /*[[${stateCode}]]*/;
    	stateCode.forEach(function( value ) {
    		stateCodeMap.set(value.snumber, value.state);
    	});

        $(function(){

            // datatableの設定を変更
            var modalesectiontable = $("#table1").DataTable({
            	fixedHeader: true,
            	"processing": true,
            	"serverSide": true,
            	"start": 0,
                "length": 10,
                "searching": false,
                "paging": true,
                "lengthChange": false,
                "ordering": false,
                "ajax": {
                	url: /*[[@{/history/getHistorylist}]]*/ 'History/getHistorylist',
                	type: "POST",
                	dataType: "json",
                	contentType: 'application/JSON',
                	data: function ( d ) {
                		d.columns[0].search.value = $('#assetNumber_search').val();
                		d.columns[1].search.value = $('#applicant_search').val();
                		d.columns[2].search.value = $('#status_search').val();
                		d.columns[3].search.value = $('#returnDate_search').val();

                        return JSON.stringify(d);
                    }
                },
                "columnDefs": [
                    { targets: 0, data: "assetNumber"},
                    { targets: 1, data: "maker"},
                    { targets: 2, data: "model"},

                    /* { targets: 3, data: "status"}, */
                    { targets: 3, data: function ( d ) {
                    	return stateCodeMap.get(d.status);
                    }},

                    { targets: 4, data: "rentNumber"},
                    { targets: 5, data: "purpose"},
                    { targets: 6, data: "storageLocation"},
                    { targets: 7, data: "applicant"},
                    { targets: 8, data: "rentuser"},
                    { targets: 9, data: "bpPartner"},
                    { targets: 10, data: function ( d ) {
                    	var rentDate = new Date(d.rentDate);
                		var yyyy = rentDate.getFullYear();
                		var mm = rentDate.getMonth()+1;
                		var dd = rentDate.getDate();
                    	return yyyy + "/" + mm + "/" + dd;
                    }},
                    { targets: 11, data: function ( d ) {
                    	var returnDate = new Date(d.returnDate);
                		var yyyy = returnDate.getFullYear();
                		var mm = returnDate.getMonth()+1;
                		var dd = returnDate.getDate();
                    	return yyyy + "/" + mm + "/" + dd;
                    }},
                ]
            });

            //Search -S
            $('#serchButton').on( 'click', function () {
            	modalesectiontable.column(0).search( this.value ).draw();
            } );


        })

    </script>

</body>
</html>