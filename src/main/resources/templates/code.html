<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- Meta, title, CSS, favicons, etc. -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>IT資産管理</title>

<!-- favicons -->
<link rel="icon" href="../images/aisRogo.png">
<!-- Bootstrap -->
<link href="../vendors/bootstrap/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Font Awesome -->
<link href="../vendors/font-awesome/css/font-awesome.min.css"
	rel="stylesheet">
<!-- NProgress -->
<link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
<!-- iCheck -->
<link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
<!-- Custom Theme Style -->
<link href="../build/css/custom.min.css" rel="stylesheet">


<style>
#datatable-list thead, th {
	text-align: center;
	vertical-align: middle;
}

#datatable-list th {
	vertical-align: middle;
}

#datatable-list td {
	vertical-align: middle;
}
</style>
</head>
<body class="nav-md">
	<div class="container body">
		<div class="main_container">
			<!-- sidebar -->
			<div th:insert="fragments/sidebar :: sidebar" th:remove="tag"></div>
			<!-- sidebar -->

			<!-- top navigation -->
			<div th:insert="fragments/top_nav :: top_nav" th:remove="tag"></div>
			<!-- /top navigation -->

			<!-- page content -->

			<!-- page content -->
			<!-- ここからコンテンツ作成 -->
			<div class="right_col" role="main">
				<div class="">
					<div class="page-title">
						<div class="title_left">
							<h3>
								<i class="fa fa-cogs"></i> コード管理
							</h3>
						</div>
					</div>
					<!-- /.page-title -->


					<div class="clearfix"></div>
					<div class="row">
						<div class="col-md-12 col-sm-12 col-xs-12">
							<div class="x_panel">
								<div class="">
									<div class="well" style="overflow: auto">
										<div class="col-md-4">
											<span class="pull-left"  style="font-size: 18px;">コードID</span>
											<div class="col-md-6 col-sm-6 ">
												<input type="text" id="search_id" class="form-control " placeholder="コードID">
											</div>
										</div>
										<div class="col-md-4">
									<span class="pull-left"  style="font-size: 18px;">コード名</span>
											<div class="col-md-6 col-sm-6 ">
												<input type="text" id="search_name" class="form-control " placeholder="コード名">
											</div>
										</div>
										<div class="col-md-4 text-right">

											<!-- 登録 ボタン -->
											<button type="button" class="btn btn-success "
												data-toggle="modal" data-target="#modalCodeMaster">
												<i class="fa fa-pencil-square" aria-hidden="true"></i> 登録
											</button>
										</div>
									</div>
									<!-- /.well -->
								</div>
								<!-- /.x_title -->
								<div class="x_content">
									<div
										class="table">

										<table id="datatable-list"
											class="table table-bordered jambo_table bulk_action text-center"
											style="width: 100%">
											<thead>
												<tr class="headings">
													<!--  <th class="column-title txt_center">No.</th> -->
													<th class="column-title txt_center col-md-3">コードID</th>
													<th class="column-title txt_center col-md-4">コード名</th>
													<th class="column-title txt_center col-md-3">使用有無</th>
													<th class="column-title txt_center col-md-2"></th>
												</tr>
											</thead>
											<!-- List 出力 -->

											<tbody>
											</tbody>

											<!--/. List 出力 -->

										</table>
									</div>
									<!-- /.table-responsive -->
								</div>
								<!-- /.x_content -->
							</div>
							<!-- /.x_panel -->
						</div>
					</div>
					<!-- /.row -->

				</div>
			</div>
			<!-- /.right_co -->
			<!-- ここまでのコンテンツ作成 -->
			<!-- /page content -->
			<!-- footer content -->
			<div th:insert="fragments/footer :: footer" th:remove="tag"></div>
			<!-- /footer content -->
		</div>
	</div>


	<!-- Modal Part マスターコード登録 -->
	<div id="modalCodeMaster" class="modal" tabindex="-1" role="dialog"
		data-backdrop="static">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h3 class="modal-title">
						<i class="fa fa-pencil-square" aria-hidden="true"></i> マスターコード登録
					</h3>

				</div>
				<div class="modal-body">
					<div style="padding: 5px 20px;">
						<form id="antoform" class="form-horizontal calender" role="form"
							method="GET" name="frm">
							<div class="form-group">
								<label class="col-sm-3 control-label"> コードID<span
										style="color: red; font-size: 18px;">*</span></label>
								<div class="col-sm-9">
									<fieldset>
										<input type="text" class="form-control form-control-sm"
											id="codeMasterId" name="codeMasterId" placeholder="ex)001"
											onKeyup="this.value = this.value.replace(/[^0-9]/g,'');"
											required />
									</fieldset>
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label"> コード名<span
										style="color: red; font-size: 18px;">*</span></label>
								<div class="col-sm-9">
									<fieldset>
										<input type="text" class="form-control form-control-sm"
											id="codeMasterName" name="codeMasterName" placeholder="ex)status_code"
											required />
									</fieldset>
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label">詳細</label>
								<div class="col-sm-9">
									<input type="text" class="form-control form-control-sm"
										id="remarks" name="remarks">
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label">使用有無</label>
								<div class="col-sm-9">
									<div id="use" class="btn-group" style="padding: 5px;">
										<label style="color: blue;"><input type="radio"
											id="button1" name="use_flag" value="0" checked>&nbsp;
											使用 &nbsp;</label> <label style="color: red"><input
											type="radio" id="" name="use_flag" value="1">&nbsp;
											未使用 &nbsp;</label>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-success"
									onclick="codeInsert();">登録</button>
								<button type="button" class="btn btn-secondary"
									data-dismiss="modal">戻る</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- /.Modal Part :: Register End -->

	<!-- Modal Part コードマスタ変更 -->
	<div id="modalCodeMaster_update" class="modal" tabindex="-1"
		role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h3 class="modal-title">
						<i class="fa fa-pencil-square" aria-hidden="true"></i> マスターコード変更
					</h3>

				</div>
				<div class="modal-body">
					<div style="padding: 5px 20px;">
						<form id="updateform" class="form-horizontal calender" role="form"
							method="GET" name="frm">
							<div class="form-group">
								<label class="col-sm-3 control-label">
									コードID<span
									style="color: red; font-size: 18px; font-size: 18px;">*</span></label>
								<div class="col-sm-9">
									<fieldset>
										<input type="text" class="form-control form-control-sm"
											id="codeMasterId_update" name="codeMasterId_update"
											placeholder="ex)001"
											onKeyup="this.value = this.value.replace(/[^0-9]/g,'');"
											required />
									</fieldset>
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label"> コード名<span
									style="color: red; font-size: 18px;">*</span></label>
								<div class="col-sm-9">
									<fieldset>
										<input type="text" class="form-control form-control-sm"
											id="codeMasterName_update" name="codeMasterName_update"
											placeholder="コード名称" required />
									</fieldset>
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label">詳細</label>
								<div class="col-sm-9">
									<input type="text" class="form-control form-control-sm"
										id="remarks_update" name="remarks_update">
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label">使用有無</label>
								<div class="col-sm-9">
									<div id="use_flag_update" class="btn-group"
										style="padding: 5px;">
										<label style="color: blue;"><input type="radio"
											id="rd1" name="use_flag_update" value="0" checked>&nbsp;
											使用 &nbsp;</label> <label style="color: red"><input
											type="radio" id="rd2" name="use_flag_update" value="1">&nbsp;
											未使用 &nbsp;</label>
									</div>
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="form-group">

								<input type="hidden" id="codeMasterId_hidden"
									name="codeMasterId_hidden">
							</div>
							<div class="clearfix"></div>
							<div class="modal-footer">

								<button type="button" class="btn btn-primary btn-warning"
									onclick="codeUpdate();">変更</button>
								<button type="button" class="btn btn-secondary"
									data-dismiss="modal">戻る</button>
							</div>
						</form>
					</div>



				</div>


			</div>
		</div>
	</div>
	<!-- /.Modal Part :: Register End -->

	<!-- jQuery -->
	<script src="../vendors/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap -->
	<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- jquery-ui -->
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<!-- DataTable -->
	<script th:src="@{/DataTables-1.10.20/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/DataTables-1.10.20/js/dataTables.bootstrap4.min.js}"></script>


	<!-- FastClick -->
	<script src="../vendors/fastclick/lib/fastclick.js"></script>
	<!-- NProgress -->
	<script src="../vendors/nprogress/nprogress.js"></script>
	<!-- iCheck -->
	<script src="../vendors/iCheck/icheck.min.js"></script>
	<!-- Custom Theme Scripts -->
	<script src="../build/js/custom.min.js"></script>

	<!-- jquery-validation-1.19.1 -->
	<script
		src="../vendors/jquery-validation-1.19.1/dist/jquery.validate.min.js"></script>


	<!-- page script -->
	<script th:inline="javascript">
		/*<![CDATA[*/

				/*validationの重なるエラーメッセージ  */
    		$.validator.messages.number = '有効な数字を入力';
    		$.validator.messages.maxlength = '{0} 文字以下を入力';
		var modalesectiondata = null;

		function codeInsert() {
			var form = $('#antoform');

			<!--入力有効性チェック -->
			form.validate({
				rules : {
					codeMasterId : {
						required : true,
						number : true,

						rangelength : [ 3, 3 ]
					},
					codeMasterName : {
						required : true,
						maxlength : 50
					}
				},
				messages : {
					codeMasterId : {
						required : "コードを入力してください",
						number : "ナンバーで入力してください",

						rangelength : "桁数は3文字です"
					},
					codeMasterName : {
						required : "コード名称を入力してください"
					}
				}
			});
			<!--マスターコードとマスターコードネームの有効性チェック -->
			if (form.valid()) {
				var masterCode = new Object();
				masterCode.codeMasterId = $('#codeMasterId').val();
				masterCode.codeMasterName = $('#codeMasterName').val();
				masterCode.useFlag = $('input[name=use_flag]:checked').val();
				masterCode.remarks = $('#remarks').val();
				$.ajax({
					"url" : "/codemaster/CodeListCheck",
					"type" : "post",
					"dataType" : "json",
					"data" : JSON.stringify(masterCode),
					"contentType" : "application/JSON",
					"success" : function(data) {
						if (data > 0) {
							alert("すでにあります");

						} else {
							location.reload(true);
						}

					}
				});
			}
		}

		$(function() {

			<!--datatableの設定を変更-->
			var modalesectiontable = $("#datatable-list")
					.DataTable(
							{
								<!--ページング-->
								"language" : {
									"info" : "_START_ ~ _END_ の _TOTAL_ 件",
									"infoEmpty" : " 0 ~ 0 の 0 件",
									"infoFiltered" : "",
									"emptyTable" : "表にデータがない",
									"paginate" : {
										"first" : "最初",
										"last" : "最後",
										"next" : "次",
										"previous" : "前"
									}
								},
								<!--検索機能 -->
								"fixedHeader" : true,
								"processing" : true,
								"serverSide" : true,
								"start" : 0,
								"length" : 10,
								"searching" : false,
								"paging" : true,
								"lengthChange" : false,
								"ordering" : false,
								"ajax" : {
									url : /*[[@{/codemaster/codeList}]]*/'codemaster/codeList',
									type : "POST",
									dataType : "json",
									contentType : 'application/JSON',
									data : function(d) {
										d.columns[0].search.value = $(
												'#search_id').val();
										d.columns[1].search.value = $(
												'#search_name').val();
										return JSON.stringify(d);
									}
								},
								"columnDefs" : [
										{
											targets : 0,
											data : "codeMasterId"
										},
										{
											targets : 1,
											data : "codeMasterName"
										},
										{
											targets : 2,
											data : function(d) {
												var str ='';
												if (d.useFlag==0) {
													str = "使用";
												} else {
													str = "未使用";
												}
												return str;
											}
										},
										{
											targets : 3,
											data : null,
											render : function(data, type, row, meta) {
												return '<button type="button" onclick="update(this)" class="btn btn-warning">変更</button><input type="hidden" id="useFlag" value="'+row.useFlag+
												'"><input type="hidden" id="detail" value="'+row.remarks+
												'"><button type="button" class="btn btn-danger deleteBtn"' +
												' id="' + row.codeMasterId + '">削除</button>';
											}
										}
										 ]
							});


			  $('#search_id').on( 'keyup', function () {
	            	$('#search_id').val(this.value.replace(new RegExp("'", 'g'), ''));
	            	modalesectiontable
	                .column(0)
	                .search( this.value )
	                .draw();
	            } );
			  $('#search_name').on( 'keyup', function () {
	            	$('#search_name').val(this.value.replace(new RegExp("'", 'g'), ''));
	            	modalesectiontable
	                .column(1)
	                .search( this.value )
	                .draw();
	            } );
			$('#datatable-list tbody').on("click", ".deleteBtn", function() {
				<!--削除機能-->
				if (!confirm('本当に削除しますか？')) {
					<!-- キャンセルの時の処理 -->
					return false;
				} else {
					<!-- OKの時の処理-->/
					$.ajax(
					/*[[@{/codemaster/delete}]]*/'codemaster/delete', {
						type : "POST",
						dataType : "json",
						contentType : 'application/JSON',
						data : this.id
					}).success(function(result) {
						location.href = '/codemaster';
					}).error(function(xhr, textStatus, error) {
						alert('通信失敗');
					});
				}

			});

		})

		function update(button) {
			<!--変更ボタンを押すと修正機能実行-->

 				var selectTr = $(button).closest("tr");
 				$('#codeMasterId_update').val(selectTr.find('td').eq(0).text());
				$('#codeMasterName_update').val(selectTr.find('td').eq(1).text());
				$('#remarks_update').val(selectTr.find('#detail').val());
				$('#codeMasterId_hidden').val(selectTr.find('td').eq(0).text());
				if(selectTr.find('#useFlag').val() == 0){
					$("#rd1").attr("checked", true);
				}else {
					$("#rd2").attr("checked", true);
				}

				$('#modalCodeMaster_update').modal();
			}

			function codeUpdate() {
				var form = $('#updateform');

				form.validate({
					<!--有効性チェック -->
					rules : {
						codeMasterId_update : {
							required : true,
							number : true,
							min : 1,
							max : 999,
							rangelength : [ 3, 3 ]
						},
						codeMasterName_update : {
							required : true
						}
					},
					messages : {
						codeMasterId_update : {
							required : "コードを入力してください",
							number : "ナンバーで入力してください",
							min : "1~999の定数を入力してください",
							max : "1~999の定数を入力してください",
							rangelength : "桁数は3文字です"
						},
						codeMasterName_update : {
							required : "コード名称を入力してください"
						}

					}

				});
				if (form.valid()) {

					var masterCode = new Object();
					masterCode.codeMasterId = $('#codeMasterId_update').val();
					masterCode.codeMasterName = $('#codeMasterName_update').val();
					masterCode.useFlag = $('input[name=use_flag_update]:checked').val();
					masterCode.remarks = $('#remarks_update').val();
					masterCode.codeMasterIdOld=$('#codeMasterId_hidden').val();
					$.ajax({
						"url" : "/codemaster/updateCodeMaster",
						"type" : "post",
						"dataType" : "json",
						"data" : JSON.stringify(masterCode),
						"contentType" : "application/JSON",
						"success" : function(data) {
							if (data > 0) {
								<!--更新成功 -->
								location.reload(true);
							} else {
								<!--更新失敗 -->
								alert('更新失敗');
							}
						}
					});
				}
			}
		/*]]>*/
	</script>

</body>
</html>
