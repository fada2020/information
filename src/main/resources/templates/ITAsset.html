<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Gentelella Alela! | </title>

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
	<link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">

    <!-- bootstrap-daterangepicker -->
    <link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">

    <style>
    	#table1 thead, th {text-align: center;}
		#table1 tbody tr{
		    cursor:pointer;
		}
	</style>

  </head>
  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
      	<!-- sidebar -->
		<div th:insert="/fragments/sidebar :: sidebar" th:remove="tag"></div>
        <!-- sidebar -->

        <!-- top navigation -->
        <div th:insert="/fragments/top_nav :: top_nav" th:remove="tag"></div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>IT資産管理</h3>
              </div>
            </div>

            <div class="clearfix"></div>

            <div class="row">
              <div class="col">
              	<div class="col-md-12"><br></div>
                <div class="col-md-1">
                    <span class="pull-right" style="font-size: 18px;">管理番号</span>
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control" placeholder="管理番号" id="assetNumber_search">
                </div>
                <div class="col-md-1">
                    <span class="pull-right" style="font-size: 18px;">区分</span>
                </div>
                <div class="col-md-2">
                	<select class="form-control" id="psNum_search">
                		<option value="-1">区分</option>
                		<option th:each="code : ${productCode}" th:value="${code.psNum}"
                		th:inline="text">[[${code.pName}]]</option>
					</select>
                </div>
                <div class="col-md-1">
                    <span class="pull-right" style="font-size: 18px;">状態</span>
                </div>
                <div class="col-md-2">
                	<select class="form-control" id="sNumber_search">
						<option value="-1">状態</option>
                		<option th:each="code : ${stateCode}" th:value="${code.sNumber}"
                		th:inline="text">[[${code.state}]]</option>
					</select>
                </div>
                <div class="col-md-1">
                    <span class="pull-right" style="font-size: 18px;">Maker</span>
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control" placeholder="Maker" id="maker_search">
                </div>

                <div class="col-md-12"><br></div>

                <div class="col-md-1">
                    <span class="pull-right" style="font-size: 18px;">Model</span>
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control" placeholder="Model" id="model_search">
                </div>
                <div class="col-md-1">
                    <span class="pull-right" style="font-size: 18px;">購入日</span>
                </div>
                <div class="col-md-2">
					<fieldset>
						<div class="control-group ">
							<div class="controls">
								<div class="input-prepend input-group">
									<span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span>
									<input type="text" style="width: 200px" name="reservation" id="reservation" class="form-control">
								</div>
							</div>
						</div>
					</fieldset>
                </div>
                <div class="col-md-6">
                    <button type="button" class="btn btn-success pull-right">登録</button>
                </div>
                <div class="x_panel">
                  <div class="x_title">
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">

					<div class="table-responsive">
                    <table class="table table-bordered table-hover table-lg text-center" id="table1">
                      <thead class="thead-light">
                        <tr>
                          <th class="col-md-2">管理番号</th>
                          <th class="col-md-1">区分</th>
                          <th class="col-md-2">Model</th>
                          <th class="col-md-1">Maker</th>
                          <th class="col-md-2">購入日</th>
                          <th class="col-md-1">保管位置</th>
                          <th class="col-md-1">状態</th>
                          <th class="col-md-2"></th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>

					<!-- modal -->
					<div class="modal" id="modal3d" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
					  <div class="modal-dialog modal-xl" style="width:70%;" role="document">
					    <div class="modal-content">
					      <div class="modal-header">
					        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					          <span aria-hidden="true">×</span>
					        </button>
					        <h3 class="modal-title">照会</h3>
					      </div>
					      <div class="modal-body">
					      	<div class="container-fluid">
							  	<div class="row">
						  			<div class="col-md-6">
						  				<div class="row">
						  					<div class="col-md-3">
						  						<span>管理番号</span>
						  					</div>
						  					<div class="col-md-3">
								  				<span id="assetNumber_view"></span>
								  			</div>
								  			<div class="col-md-3">
								  				<span>区分</span>
								  			</div>
								  			<div class="col-md-3">
								  				<span id="psNum_view"></span>
								  			</div>
						  				</div>
						  			</div>
						  			<div class="col-md-6">
						  				<div class="row">
						  					<div class="col-md-3">
							  					<span>購入日</span>
							  				</div>
							  				<div class="col-md-3">
							  					<span id="purchaseDate_view"></span>
							  				</div>
							  				<div class="col-md-3">
							  					<span>保証期間</span>
							  				</div>
							  				<div class="col-md-3">
							  					<span id="warrantyPeriod_view"></span>
							  				</div>
						  				</div>
						  			</div>

						  			<div class="col-md-6">
						  				<div class="row">
						  					<div class="col-md-3">
						  						<span>購入先</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="buyTo_view"></span>
						  					</div>
						  					<div class="col-md-3">
						  						<span>購入金額</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="purchasePrice_view"></span>
						  					</div>
						  				</div>
						  			</div>
						  			<div class="col-md-6">
						  				<div class="row">
						  					<div class="col-md-3">
						  						<span>保管位置</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="storageLocation_view"></span>
						  					</div>
						  					<div class="col-md-3">
						  						<span>状態</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="sNumber_view"></span>
						  					</div>
						  				</div>
						  			</div>

						  			<div class="col-md-6">
						  				<div class="row">
						  					<div class="col-md-3">
						  						<span>Maker</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="maker_view"></span>
						  					</div>
						  					<div class="col-md-3">
						  						<span>Model</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="model_view"></span>
						  					</div>
						  				</div>
						  			</div>
						  			<div class="col-md-6">
						  				<div class="row">
						  					<div class="col-md-3">
						  						<span>S/N</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="serialNum_view"></span>
						  					</div>
						  					<div class="col-md-3">
						  						<span>I/F</span>
						  					</div>
						  					<div class="col-md-3">
						  						<span id="interFaceCol_view"></span>
						  					</div>
						  				</div>
						  			</div>

						  			<div class="col-md-12">
						  				<span>OS</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>名(Edition)</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="OSName_view"></span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>Product Key</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="OSProductKey_view"></span>
						  			</div>

						  			<div class="col-md-12">
						  				<span>CPU</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>Processor</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="CPUProcessor_view"></span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>動作周波数</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="operatingFrequency_view"></span>
						  			</div>

						  			<div class="col-md-6">
						  				<span>Memory</span>
						  			</div>
						  			<div class="col-md-6">
						  				<span>HDD</span>
						  			</div>
						  			<div class="col-md-2">
						  				<span id="memory_view"></span>
						  			</div>
						  			<div class="col-md-2">
						  				<span>Upgarde</span>
						  			</div>
						  			<div class="col-md-2">
						  				<span id="memoryUpgarde_view"></span>
						  			</div>
						  			<div class="col-md-2">
						  				<span id="HDD_view"></span>
						  			</div>
						  			<div class="col-md-2">
						  				<span>Upgarde</span>
						  			</div>
						  			<div class="col-md-2">
						  				<span id="HDDUpgarde_view"></span>
						  			</div>

						  			<div class="col-md-12">
						  				<span>MAC</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>LAN</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="MACLAN_view"></span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>Wireless</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="MACWireless_view"></span>
						  			</div>

						  			<div class="col-md-12">
						  				<span>その他</span>
						  			</div>
						  			<div class="col-md-12">
						  				<span id="other_view"></span>
						  			</div>

						  			<div class="col-md-12">
						  				<span>Security</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>BIOS</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="securityBIOS_view"></span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>HDD</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="securityHDD_view"></span>
						  			</div>

						  			<div class="col-md-12">
						  				<span>Admin.Account</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>ID</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="adminAccountID_view"></span>
						  			</div>
						  			<div class="col-md-3">
						  				<span>PW</span>
						  			</div>
						  			<div class="col-md-3">
						  				<span id="adminAccountPW_view"></span>
						  			</div>


							  	</div>
						  	</div>
					      </div>
					      <div class="modal-footer">
					        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					      </div>
					    </div>
					  </div>
					</div>
					</div>
					<!-- /modal -->

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <div th:insert="/fragments/footer :: footer" th:remove="tag"></div>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- jquery-ui -->
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<!-- DataTable -->
	<script th:src="@{/DataTables-1.10.20/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/DataTables-1.10.20/js/dataTables.bootstrap4.min.js}"></script>

    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>

    <!-- page script -->
    <script th:inline="javascript">
    /*<![CDATA[*/
        var modalesectiondata = null;

    	var productCodeMap = new Map();
		var productCode = /*[[${productCode}]]*/;
    	productCode.forEach(function( value ) {
    		productCodeMap.set(value.psNum, value.pname);
    	});
    	var stateCodeMap = new Map();
    	var stateCode = /*[[${stateCode}]]*/;
    	stateCode.forEach(function( value ) {
    		stateCodeMap.set(value.snumber, value.state);
    	});

        $(function(){

			$('#reservation').daterangepicker({
				startDate: moment().add(-12, "months"),
				endDate: moment(),
			 locale: {
			       format: 'YYYY-MM-DD'
			   }, function(start, end, label) {
			       console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
			   }
			});

            // datatableの設定を変更
            var modalesectiontable = $("#table1").DataTable({
            	"language": {
            		"info":           "表示 _START_ ~ _END_ の _TOTAL_ エントリ",
            		"infoEmpty":      "表示 0 ~ 0 の 0 エントリ",
            	    "infoFiltered":   "",
            	    "paginate": {
            	        "first":      "最初",
            	        "last":       "最後",
            	        "next":       "次へ",
            	        "previous":   "前の"
            	    }
                },
            	"fixedHeader": true,
            	"processing": true,
            	"serverSide": true,
            	"start": 0,
                "length": 10,
                "searching": false,
                "paging": true,
                "lengthChange": false,
                "ordering": false,
                "ajax": {
                	url: /*[[@{/ITAsset/getITAssetlist}]]*/ 'ITAsset/getITAssetlist',
                	type: "POST",
                	dataType: "json",
                	contentType: 'application/JSON',
                	data: function ( d ) {
                		d.columns[0].search.value = $('#assetNumber_search').val();
                		d.columns[1].search.value = $('#psNum_search').val();
                		d.columns[2].search.value = $('#sNumber_search').val();
                		d.columns[3].search.value = $('#maker_search').val();
                		d.columns[4].search.value = $('#model_search').val();
                		d.columns[5].search.value = $('#reservation').val();
                        return JSON.stringify(d);
                    }
                },
                "columnDefs": [
                    { targets: 0, data: "assetNumber"},
                    { targets: 1, data: function ( d ) {
                    	return productCodeMap.get(d.psNum);
                    }},
                    { targets: 2, data: "model"},
                    { targets: 3, data: "maker"},
                    { targets: 4, data: function ( d ) {
                    	var purchaseDate = new Date(d.purchaseDate);
                		var yyyy = purchaseDate.getFullYear(); var mm = purchaseDate.getMonth()+1;
                		var dd = purchaseDate.getDate();
                    	return yyyy + "-" + mm + "-" + dd;
                    }},
                    { targets: 5, data: "storageLocation"},
                    { targets: 6, data: function ( d ) {
                    	return stateCodeMap.get(d.snumber);
                    }},
                    {
                    	targets: 7,
                    	data: "update",
                        render: function ( data, type, row, meta ) {
                          return '<button type="button" class="btn btn-warning" onclick = "location.href =\'' +
                          'ITAsset/' + row.assetNumber + '\'">更新</button><button type="button" class="btn btn-danger" onclick = "location.href =\'' +
                          'ITAsset/' + row.assetNumber + '\'">削除</button>';
                        }
                    }
                ]
            });

            // Search
            $('#assetNumber_search').on( 'keyup', function () {
            	modalesectiontable
                .column(0)
                .search( this.value )
                .draw();
            } );

            $('#psNum_search').change(function() {
            	modalesectiontable
                .column(1)
                .search( this.value )
                .draw();
            });

            $('#sNumber_search').change(function() {
            	modalesectiontable
                .column(2)
                .search( this.value )
                .draw();
            });

            $('#maker_search').on( 'keyup', function () {
            	modalesectiontable
                .column(3)
                .search( this.value )
                .draw();
            });

            $('#model_search').on( 'keyup', function () {
            	modalesectiontable
                .column(4)
                .search( this.value )
                .draw();
            });

            $("#reservation").change(function () {
                var date = $("#reservation").val();
                alert(date);
                modalesectiontable
                .column(5)
                .search(date)
                .draw();
            });

            $('#table1 tbody').on( 'click', 'tr td', function () {
            	var rowData = modalesectiontable.row( this ).data();
            	if(this._DT_CellIndex.column != 7) {
            		$('#modal3d').modal();

            		var purchaseDate = new Date(rowData.purchaseDate);
            		var yyyy = purchaseDate.getFullYear(); var mm = purchaseDate.getMonth()+1;
            		var dd = purchaseDate.getDate();

            		$('#assetNumber_view').text(rowData.assetNumber);
            		$('#psNum_view').text(productCodeMap.get(rowData.psNum));
            		$('#purchaseDate_view').text(yyyy + "-" + mm + "-" + dd);
            		$('#warrantyPeriod_view').text(rowData.warrantyPeriod + "年");

            		$('#buyTo_view').text(rowData.buyTo);
            		$('#purchasePrice_view').text(rowData.purchasePrice);
            		$('#storageLocation_view').text(rowData.storageLocation);
            		$('#sNumber_view').text(stateCodeMap.get(rowData.snumber));

            		$('#maker_view').text(rowData.maker);
            		$('#model_view').text(rowData.model);
            		$('#serialNum_view').text(rowData.serialNum);
            		$('#interFaceCol_view').text(rowData.interFaceCol);

            		$('#OSName_view').text(rowData.osname);
            		$('#OSProductKey_view').text(rowData.osproductKey);
            		$('#CPUProcessor_view').text(rowData.cpuprocessor);
            		$('#operatingFrequency_view').text(rowData.operatingFrequency);

            		$('#memory_view').text(rowData.memory + "GB");
            		$('#memoryUpgarde_view').text(rowData.memoryUpgarde + "GB");
            		$('#HDD_view').text(rowData.hdd + "GB");
            		$('#HDDUpgarde_view').text(rowData.hddupgarde + "GB");

            		$('#MACLAN_view').text(rowData.maclan);
            		$('#MACWireless_view').text(rowData.macwireless);

            		$('#other_view').text(rowData.other);

            		$('#securityBIOS_view').text(rowData.securityBIOS);
            		$('#securityHDD_view').text(rowData.securityHDD);

            		$('#adminAccountID_view').text(rowData.adminAccountID);
            		$('#adminAccountPW_view').text(rowData.adminAccountPW);

            	} else {
            		//alert(JSON.stringify(rowData));
            	}
            } );

        })
    /*]]>*/
    </script>

</body>
</html>